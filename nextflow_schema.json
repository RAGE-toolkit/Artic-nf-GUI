{
    "$schema": "http://json-schema.org/draft-07/schema",
    "$id": "https://raw.githubusercontent.com/./master/nextflow_schema.json",
    "title": "RAGE-toolkit/Artic-nf",
    "workflow_title": "Artic_nf",
    "description": "Raw data processing and consensus generation",
    "url": "https://github.com/RAGE-toolkit/Artic-nf",
    "type": "object",
    "definitions": {
        "input": {
            "title": "Input",
            "type": "object",
            "fa_icon": "fas fa-arrow-right",
            "description": "Parameters for finding and handling input data for analysis.",
            "properties": {
                "meta_file": {
                    "title": "meta data file",
                    "type": "string",
                    "format": "file-path",
                    "description": "Workflow accepts the CSV file format",
                    "help_text": "Refer the GitHub repo to know more about the file format"
                },
                "rawfile_dir": {
                    "type": "string",
                    "format": "directory-path",
                    "title": "FASTQ",
                    "description": "FASTQ/POD5/FAST5 files to upload.",
                    "help_text": "FASTQ/POD5/FAST5 directories to upload."
                },
		            "rawfile_type": {
                    "type": "string",
                    "title": "Raw file type",
                    "description": "Choose the raw file type from a given list",
                    "help_text": "Available file types are fastq and fast5_pod5.",
                    "enum": [
                        "fastq",
                        "fast5_pod5"
                    ],
                    "default": "fastq"
                },
                "primer_schema": {
                    "type": "string",
                    "format": "directory-path",
                    "description": "Path to a primer scheme. Example path /Documents/GitHub/Artic-nf/meta_data/primer_scheme"
                },
		            "basecaller": {
                    "type": "string",
                    "title": "Basecaller to run",
                    "description": "Choose the basecaller from given list",
                    "help_text": "Available basecallers are Dorado and Guppy",
                    "enum": [
                        "Dorado",
                        "Guppy"
                    ],
                    "default": "Dorado"
                },
		            "kit_name": {
                    "type": "string",
                    "default": "EXP-NBD196",
                    "description": "Path to a primary schema", 
                    "help_text": "You can get the barcode list from Guppy or Dorado GitHub repo."
                },
                "run_name": {
                    "type": "string",
                    "default": "test_run",
                    "description": "Specify the run name used in the ONT experiment.",
                    "help_text": "Name your sequencing run so it’s easy to identify later. This label will appear in result file names. For example: test_run_sample1"
               }

     },       

            "allOf": [
                {
                    "required": [
                        "primer_schema",
												"rawfile_dir",
												"rawfile_type"
                    ]
                }
            ]
        },

       "output": {
            "title": "Output Options",
            "type": "object",
            "fa_icon": "fas fa-folder-open",
            "description": "Set output directory",
            "properties": {
                "output_dir": {
                    "type": "string",
                    "default": "results",
                    "format": "directory-path",
                    "description": "Directory for output of all workflow results. By default it creates 'results' directory to store output."
                }
            }
        },

        "basecalling_options": {
           "title": "Basecalling options",
           "type": "object",
           "fa_icon": "fas fa-vials",
           "description": "Setting the basecaller and model paths",
           "properties": {
               "basecaller_dir": {
                   "type": "string",
                   "format": "file-path",
                   "description": "Path of your basecaller",
                   "help_text": "Set basecaller paths if running basecalling; otherwise, ignore this tab."
                },
                "model_dir": {
                    "type": "string",
                    "format": "directory-path",
                    "description": "Specify the basecalling model. Required only when running Dorado; otherwise leave blank."
                },
                "basecaller_config": {
                    "type": "string",
                    "title": "Config file for basecaller",
                    "default": "dna_r10.4.1_e8.2_400bps_fast@v4.2.0",
                    "description": "Change the config accordingly."
                },
                "basecaller_threads": {
                     "type": "integer",
                     "default": 5,
                     "description": "Use this field when running Guppy basecaller. Ignore otherwise",
                     "help_text": "This option works for Guppy. Ignore threads if using Dorado basecaller."
                },
                "gpu_mode": {
                     "type": "string",
                     "title": "GPU cores to use for basecalling",
                     "default": "cuda:all",
                     "description": "Enable GPU mode if a compatible GPU is available; otherwise, select ‘none’ to run basecalling on CPU.",
                     "help_text": "Enable GPU acceleration for basecalling. Requires a compatible GPU and a GPU-enabled basecaller; older Guppy releases may not support GPU."
                }
            }
        },

        "advanced_options": {
            "title": "Advanced options",
            "type": "object",
            "fa_icon": "far fa-question-circle",
            "description": "Advanced options",
            "help_text": "By default they do not need to be changed. Unless you need a tuning",
            "properties": {
                "fastq_dir": {
                    "type": "string",
                    "default": "raw_files/fastq",
                    "description": "Stores the guppyplexed fastq files for medaka",
                    "help_text": "This directory will be autogenerated by the workflow."
                },
                "fq_extension": {
                    "type": "string",
                    "default": ".fastq",
                    "description": "Extension of fastq files."
                 },
                "seq_len": {
                    "type": "integer",
                    "default": 350,
                    "description": "Sequence lenght for plexing. This depends on the primer size."                  
                 },
                 "medaka_model": {
                     "type": "string",
                     "default": "r941_min_fast_g303",
                     "description": "Medaka model used."
                 },
                 "medaka_normalise": {
                     "type": "integer",
                     "default": 200,
                     "description": "Medaka normalization value.",
                     "help_text": "Medaka normalizes coverage by randomly subsampling reads. Set this to the target depth (e.g. 200) to reduce runtime and memory usage while maintaining accuracy."
                 },
                 "mask_depth": {
                     "type": "integer",
                     "default": 20,
                     "description": "Mask depth, used during consensus sequence generation."
                 
                 }
        }
  },

        "misc": {
            "title": "Miscellaneous Options",
            "type": "object",
            "description": "Everything else.",
            "default": "",
            "properties": {
                "threads": {
                    "type": "integer",
                    "default": 5,
                    "minimum": 5,
                    "description": "Number of CPU threads to use.",
                    "help_text": "Some of the processes uses the threads for mulitprocessing (note that the memory used by minimap2 scales with the number of threads). The total CPU resources used by the workflow are constrained by the executor configuration and can be modified by changing `nextflow.config` or supplying an additional config file."
                },
                "queueSize": {
                    "type": "integer",
                    "default": 5,
                    "minimum": 5,
                    "description": "Maximum number of tasks that the executor can run in parallel",
                    "help_text": "A value of 1 forces strictly serial execution, while higher values allow multiple processes to run concurrently. Increasing this can speed up throughput if sufficient resources are available. Reduced the number for debugging or limiting memory/CPU usage."
            		}
            }
	}
    },
    "allOf": [
        {
            "$ref": "#/definitions/input"
        },
        {
            "$ref": "#/definitions/output_option"
        },
        {
            "$ref": "#/definitions/basecalling_options"
        },
        {
            "$ref": "#/definitions/advanced_options"
        },
        {
            "$ref": "#/definitions/misc"
        }
    ],
    "resources": {
        "recommended": {
            "cpus": 5,
            "memory": "10GB"
        },
        "minimum": {
            "cpus": 4,
            "memory": "8GB"
        },
        "run_time": "1 minutes per sample (depending on number of reads, length of reference, and available compute).",
        "arm_support": true
    }
}
